<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Evaluación de Empleados</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .login-screen {
            padding: 40px;
            text-align: center;
        }

        .login-form {
            max-width: 300px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .btn {
            background-color: #4CAF50;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }

        .btn:hover {
            background-color: #45a049;
        }

        .btn-secondary {
            background-color: #2196F3;
        }

        .btn-secondary:hover {
            background-color: #1976D2;
        }

        .btn-nav {
            background: #FF9800;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 0 10px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .btn-nav:hover {
            background: #F57C00;
        }

        .btn-report {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .btn-report:hover {
            background: #1976D2;
        }

        .header {
            background-color: #8BC34A;
            color: white;
            text-align: center;
            padding: 15px;
            font-weight: bold;
            font-size: 16px;
        }

        .week-header {
            background-color: #A5D6A7;
            color: #2E7D32;
            text-align: center;
            padding: 10px;
            font-weight: bold;
        }

        .evaluation-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        .evaluation-table th {
            background-color: #E8F5E8;
            padding: 8px 4px;
            text-align: center;
            font-weight: bold;
            border: 1px solid #ddd;
            font-size: 11px;
        }

        .evaluation-table td {
            padding: 6px 4px;
            border: 1px solid #ddd;
            text-align: center;
            vertical-align: middle;
        }

        .employee-name {
            text-align: left !important;
            font-weight: bold;
            background-color: #f9f9f9;
            padding-left: 10px !important;
            min-width: 200px;
            font-size: 11px;
        }

        .category-header {
            background-color: #C8E6C9;
            font-weight: bold;
            color: #2E7D32;
        }

        .day-header {
            background-color: #FFE082;
            font-weight: bold;
            color: #F57C00;
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2px;
        }

        .evaluation-checkbox {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }
        .evaluation-checkbox:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}
        .item-select {
            padding: 2px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 10px;
            min-width: 90px;
            max-width: 100px;
        }

        .item-select.has-issue {
            background-color: #ffebee;
            border-color: #f44336;
        }

        .week-management {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #ddd;
        }

        .week-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .day-navigation {
            padding: 15px 20px;
            background: #e8f5e8;
            border-bottom: 1px solid #ddd;
            display: none;
        }

        .day-tabs {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .day-tab {
            padding: 8px 16px;
            background: #fff;
            border: 2px solid #4CAF50;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .day-tab:hover {
            background: #f0f8f0;
        }

        .day-tab.active {
            background: #4CAF50;
            color: white;
        }

        .reports-module {
            padding: 20px;
            background: #f0f8ff;
            border-bottom: 1px solid #ddd;
            display: none;
        }

        .reports-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .reports-controls input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .navigation-buttons {
            text-align: center;
            padding: 20px;
        }

        .single-day-table {
            display: none;
        }

        .single-day-table.active {
            display: table;
        }

        .hidden {
            display: none;
        }

        .stats {
            margin-top: 20px;
            padding: 15px;
            background-color: #e3f2fd;
            border-radius: 4px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .stat-item {
            background: white;
            padding: 8px;
            border-radius: 4px;
            text-align: center;
        }

        .stat-number {
            font-size: 20px;
            font-weight: bold;
            color: #1976d2;
        }

        @media (max-width: 768px) {
            .evaluation-table {
                font-size: 10px;
            }
            
            .evaluation-table td, .evaluation-table th {
                padding: 4px 2px;
            }
            
            .item-select {
                min-width: 70px;
                font-size: 9px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Pantalla de Login -->
        <div id="loginScreen" class="login-screen">
            <h2>Sistema de Evaluación de Empleados</h2>
            <div class="login-form">
                <div class="form-group">
                    <label for="managerId">ID de Manager:</label>
                    <select id="managerId">
                        <option value="">Seleccionar Manager</option>
                        <option value="MGR001">David Maldonado (MGR001)</option>
                        <option value="MGR002">Ana García (MGR002)</option>
                        <option value="MGR003">Carlos López (MGR003)</option>
                        <option value="MGR004">María Rodríguez (MGR004)</option>
                    </select>
                </div>
                <button class="btn" onclick="login()">Ingresar</button>
            </div>
        </div>

        <!-- Pantalla Principal -->
        <div id="mainScreen" class="hidden">
            <!-- Header del Manager -->
            <div id="managerHeader" class="header"></div>
            
            <!-- Controles de Semana -->
            <div class="week-management">
                <div class="week-controls">
                    <div>
                        <input type="text" id="startDate" placeholder="Fecha Inicio (DD/MM/YYYY)" style="margin-right: 10px; padding: 8px;">
                        <input type="text" id="endDate" placeholder="Fecha Fin (DD/MM/YYYY)" style="margin-right: 10px; padding: 8px;">
                        <button class="btn" onclick="createNewWeek()">Crear Nueva Semana</button>
                        <button class="btn btn-secondary" onclick="loadWeek()">Cargar Semana</button>
                    </div>
                    <div>
                        <select id="weekSelect">
                            <option value="">Seleccionar semana...</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Navegación entre vistas -->
            <div class="navigation-buttons">
                <button class="btn-nav" onclick="showWeekView()">Vista Semanal</button>
                <button class="btn-nav" onclick="showDayView()">Vista por Día</button>
                <button class="btn-nav" onclick="showReports()">Reportes</button>
            </div>

            <!-- Navegación por días -->
            <div id="dayNavigation" class="day-navigation">
                <div class="day-tabs">
                    <div class="day-tab" onclick="selectDay('LUNES')">LUNES</div>
                    <div class="day-tab" onclick="selectDay('MARTES')">MARTES</div>
                    <div class="day-tab" onclick="selectDay('MIÉRCOLES')">MIÉRCOLES</div>
                    <div class="day-tab" onclick="selectDay('JUEVES')">JUEVES</div>
                    <div class="day-tab" onclick="selectDay('VIERNES')">VIERNES</div>
                </div>
            </div>

            <!-- Módulo de Reportes -->
            <div id="reportsModule" class="reports-module">
                <h3>Módulo de Reportes</h3>
                <div class="reports-controls">
                    <input type="text" id="reportStartDate" placeholder="Fecha Inicio (DD/MM/YYYY)">
                    <input type="text" id="reportEndDate" placeholder="Fecha Fin (DD/MM/YYYY)">
                    <button class="btn-report" onclick="generatePDFReport()">Generar PDF</button>
                    <button class="btn-report" onclick="generateCSVReport()">Generar CSV</button>
                </div>
            </div>

            <!-- Tabla de Evaluación -->
            <div id="evaluationSection" class="hidden">
                <div id="weekHeader" class="week-header"></div>
                
                <!-- Vista Semanal -->
                <table class="evaluation-table" id="weeklyTable">
                    <thead>
                        <tr>
                            <th rowspan="2">EMPLEADO</th>
                            <th colspan="8" class="day-header">LUNES</th>
                            <th colspan="8" class="day-header">MARTES</th>
                            <th colspan="8" class="day-header">MIÉRCOLES</th>
                            <th colspan="8" class="day-header">JUEVES</th>
                            <th colspan="8" class="day-header">VIERNES</th>
                        </tr>
                        <tr>
                            <!-- Lunes -->
                            <th class="category-header">✓</th>
                            <th class="category-header">ASISTENCIA</th>
                            <th class="category-header">✓</th>
                            <th class="category-header">PLÁTICAS</th>
                            <th class="category-header">✓</th>
                            <th class="category-header">PRODUCTIVIDAD</th>
                            <th class="category-header">✓</th>
                            <th class="category-header">ACTITUD</th>
                            <!-- Martes -->
                            <th class="category-header">✓</th>
                            <th class="category-header">ASISTENCIA</th>
                            <th class="category-header">✓</th>
                            <th class="category-header">PLÁTICAS</th>
                            <th class="category-header">✓</th>
                            <th class="category-header">PRODUCTIVIDAD</th>
                            <th class="category-header">✓</th>
                            <th class="category-header">ACTITUD</th>
                            <!-- Miércoles -->
                            <th class="category-header">✓</th>
                            <th class="category-header">ASISTENCIA</th>
                            <th class="category-header">✓</th>
                            <th class="category-header">PLÁTICAS</th>
                            <th class="category-header">✓</th>
                            <th class="category-header">PRODUCTIVIDAD</th>
                            <th class="category-header">✓</th>
                            <th class="category-header">ACTITUD</th>
                            <!-- Jueves -->
                            <th class="category-header">✓</th>
                            <th class="category-header">ASISTENCIA</th>
                            <th class="category-header">✓</th>
                            <th class="category-header">PLÁTICAS</th>
                            <th class="category-header">✓</th>
                            <th class="category-header">PRODUCTIVIDAD</th>
                            <th class="category-header">✓</th>
                            <th class="category-header">ACTITUD</th>
                            <!-- Viernes -->
                            <th class="category-header">✓</th>
                            <th class="category-header">ASISTENCIA</th>
                            <th class="category-header">✓</th>
                            <th class="category-header">PLÁTICAS</th>
                            <th class="category-header">✓</th>
                            <th class="category-header">PRODUCTIVIDAD</th>
                            <th class="category-header">✓</th>
                            <th class="category-header">ACTITUD</th>
                        </tr>
                    </thead>
                    <tbody id="evaluationTableBody">
                    </tbody>
                </table>

                <!-- Tablas de Vista por Día -->
                <table class="evaluation-table single-day-table" id="mondayTable">
                    <thead>
                        <tr>
                            <th rowspan="2">EMPLEADO</th>
                            <th colspan="8" class="day-header">LUNES</th>
                        </tr>
                        <tr>
                            <th class="category-header">✓</th>
                            <th class="category-header">ASISTENCIA</th>
                            <th class="category-header">✓</th>
                            <th class="category-header">PLÁTICAS</th>
                            <th class="category-header">✓</th>
                            <th class="category-header">PRODUCTIVIDAD</th>
                            <th class="category-header">✓</th>
                            <th class="category-header">ACTITUD</th>
                        </tr>
                    </thead>
                    <tbody id="mondayTableBody"></tbody>
                </table>

                <table class="evaluation-table single-day-table" id="tuesdayTable">
                    <thead>
                        <tr>
                            <th rowspan="2">EMPLEADO</th>
                            <th colspan="8" class="day-header">MARTES</th>
                        </tr>
                        <tr>
                            <th class="category-header">✓</th>
                            <th class="category-header">ASISTENCIA</th>
                            <th class="category-header">✓</th>
                            <th class="category-header">PLÁTICAS</th>
                            <th class="category-header">✓</th>
                            <th class="category-header">PRODUCTIVIDAD</th>
                            <th class="category-header">✓</th>
                            <th class="category-header">ACTITUD</th>
                        </tr>
                    </thead>
                    <tbody id="tuesdayTableBody"></tbody>
                </table>

                <table class="evaluation-table single-day-table" id="wednesdayTable">
                    <thead>
                        <tr>
                            <th rowspan="2">EMPLEADO</th>
                            <th colspan="8" class="day-header">MIÉRCOLES</th>
                        </tr>
                        <tr>
                            <th class="category-header">✓</th>
                            <th class="category-header">ASISTENCIA</th>
                            <th class="category-header">✓</th>
                            <th class="category-header">PLÁTICAS</th>
                            <th class="category-header">✓</th>
                            <th class="category-header">PRODUCTIVIDAD</th>
                            <th class="category-header">✓</th>
                            <th class="category-header">ACTITUD</th>
                        </tr>
                    </thead>
                    <tbody id="wednesdayTableBody"></tbody>
                </table>

                <table class="evaluation-table single-day-table" id="thursdayTable">
                    <thead>
                        <tr>
                            <th rowspan="2">EMPLEADO</th>
                            <th colspan="8" class="day-header">JUEVES</th>
                        </tr>
                        <tr>
                            <th class="category-header">✓</th>
                            <th class="category-header">ASISTENCIA</th>
                            <th class="category-header">✓</th>
                            <th class="category-header">PLÁTICAS</th>
                            <th class="category-header">✓</th>
                            <th class="category-header">PRODUCTIVIDAD</th>
                            <th class="category-header">✓</th>
                            <th class="category-header">ACTITUD</th>
                        </tr>
                    </thead>
                    <tbody id="thursdayTableBody"></tbody>
                </table>

                <table class="evaluation-table single-day-table" id="fridayTable">
                    <thead>
                        <tr>
                            <th rowspan="2">EMPLEADO</th>
                            <th colspan="8" class="day-header">VIERNES</th>
                        </tr>
                        <tr>
                            <th class="category-header">✓</th>
                            <th class="category-header">ASISTENCIA</th>
                            <th class="category-header">✓</th>
                            <th class="category-header">PLÁTICAS</th>
                            <th class="category-header">✓</th>
                            <th class="category-header">PRODUCTIVIDAD</th>
                            <th class="category-header">✓</th>
                            <th class="category-header">ACTITUD</th>
                        </tr>
                    </thead>
                    <tbody id="fridayTableBody"></tbody>
                </table>

                <div class="stats">
                    <h3>Estadísticas de la Semana</h3>
                    <div class="stats-grid" id="statsGrid">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class EmployeeEvaluationSystem {
            constructor() {
                this.currentManager = null;
                this.currentWeek = null;
                this.evaluationData = {};
                
                this.managers = {
                    'MGR001': {
                        name: 'DAVID MALDONADO',
                        employees: [
                            { id: 'EMP001', name: 'LOURDES RAQUEL AGUIRRE' },
                            { id: 'EMP002', name: 'ERICKA DANIELA MARTINEZ' },
                            { id: 'EMP003', name: 'ASTRID MARIELA COLINDRES ZELAYA' },
                            { id: 'EMP004', name: 'EVELYN DANIELA OSEGUERA AGUILAR' },
                            { id: 'EMP005', name: 'ANGEL DAVID ALVARENGA MARTINEZ' }
                        ]
                    },
                    'MGR002': {
                        name: 'ANA GARCÍA',
                        employees: [
                            { id: 'EMP006', name: 'JUAN CARLOS MENDEZ' },
                            { id: 'EMP007', name: 'SOFIA ELENA TORRES' },
                            { id: 'EMP008', name: 'RICARDO ANTONIO FLORES' },
                            { id: 'EMP009', name: 'PATRICIA ISABEL MORALES' },
                            { id: 'EMP010', name: 'FERNANDO JOSE HERRERA' }
                        ]
                    },
                    'MGR003': {
                        name: 'CARLOS LÓPEZ',
                        employees: [
                            { id: 'EMP011', name: 'CLAUDIA PATRICIA RIVERA' },
                            { id: 'EMP012', name: 'MIGUEL ANGEL SANTOS' },
                            { id: 'EMP013', name: 'ANDREA LUCIA VARGAS' },
                            { id: 'EMP014', name: 'JOSE MANUEL CASTRO' },
                            { id: 'EMP015', name: 'GABRIELA MARIA JIMENEZ' }
                        ]
                    },
                    'MGR004': {
                        name: 'MARÍA RODRÍGUEZ',
                        employees: [
                            { id: 'EMP016', name: 'ROBERTO CARLOS PEÑA' },
                            { id: 'EMP017', name: 'VALERIA ALEJANDRA CRUZ' },
                            { id: 'EMP018', name: 'DIEGO FERNANDO RAMOS' },
                            { id: 'EMP019', name: 'CAROLINA BEATRIZ ORTEGA' },
                            { id: 'EMP020', name: 'ALEJANDRO DAVID SILVA' }
                        ]
                    }
                };

                this.evaluationItems = {
                    asistencia: [
                        'Sin problemas',
                        'Llegó tarde',
                        'Pausa excesiva',
                        'Salió temprano',
                        'Falta injustificada'
                    ],
                    platicas: [
                        'Sin problemas',
                        'Plática excesiva',
                        'Plática entre compañeros',
                        'Uso de teléfono personal',
                        'Distracción general'
                    ],
                    productividad: [
                        'Sin problemas',
                        'Bajo rendimiento',
                        'Errores frecuentes',
                        'Lentitud en tareas',
                        'No cumple objetivos'
                    ],
                    actitud: [
                        'Sin problemas',
                        'Actitud negativa',
                        'Falta de cooperación',
                        'Conflictos con compañeros',
                        'Resistencia a instrucciones'
                    ]
                };

                this.categories = ['ASISTENCIA', 'PLÁTICAS', 'PRODUCTIVIDAD', 'ACTITUD'];
                
                this.categoryMapping = {
                    'ASISTENCIA': 'asistencia',
                    'PLÁTICAS': 'platicas',
                    'PRODUCTIVIDAD': 'productividad',
                    'ACTITUD': 'actitud'
                };

                this.days = ['LUNES', 'MARTES', 'MIÉRCOLES', 'JUEVES', 'VIERNES'];

                this.loadStoredData();
            }

            login() {
                const managerId = document.getElementById('managerId').value;
                if (!managerId) {
                    alert('Por favor selecciona un manager');
                    return;
                }

                this.currentManager = managerId;
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainScreen').classList.remove('hidden');
                document.getElementById('managerHeader').textContent = `MANAGER ${this.managers[managerId].name}`;
                
                this.loadWeekOptions();
            }

            loadWeekOptions() {
                const weekSelect = document.getElementById('weekSelect');
                weekSelect.innerHTML = '<option value="">Seleccionar semana...</option>';
                
                const managerData = this.evaluationData[this.currentManager] || {};
                Object.keys(managerData).forEach(weekKey => {
                    const option = document.createElement('option');
                    option.value = weekKey;
                    option.textContent = weekKey;
                    weekSelect.appendChild(option);
                });
            }

            createNewWeek() {
                const startDateInput = document.getElementById('startDate').value;
                const endDateInput = document.getElementById('endDate').value;

                if (!startDateInput || !endDateInput) {
                    alert('Por favor ingrese ambas fechas');
                    return;
                }

                if (!this.validateWeekDates(startDateInput, endDateInput)) {
                    return;
                }

                const weekKey = `${startDateInput} - ${endDateInput}`;
                this.currentWeek = weekKey;

                this.initializeWeekData(weekKey);
                this.renderWeeklyEvaluationTable();
                this.loadWeekOptions();
                
                document.getElementById('evaluationSection').classList.remove('hidden');
                document.getElementById('weekHeader').textContent = weekKey;
                
                // Set week select to current week
                document.getElementById('weekSelect').value = weekKey;
            }

            validateWeekDates(startDateInput, endDateInput) {
                const dateRegex = /^(\d{2})\/(\d{2})\/(\d{4})$/;
                if (!dateRegex.test(startDateInput) || !dateRegex.test(endDateInput)) {
                    alert('Formato de fecha incorrecto. Use DD/MM/YYYY');
                    return false;
                }
                
                const [startDay, startMonth, startYear] = startDateInput.split('/');
                const [endDay, endMonth, endYear] = endDateInput.split('/');
                
                const startDate = new Date(startYear, startMonth - 1, startDay);
                const endDate = new Date(endYear, endMonth - 1, endDay);
                
                if (startDate.getDay() !== 1) {
                    alert('La fecha de inicio debe ser un LUNES');
                    return false;
                }
                
                if (endDate.getDay() !== 5) {
                    alert('La fecha de fin debe ser un VIERNES');
                    return false;
                }
                
                const diffTime = Math.abs(endDate - startDate);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                if (diffDays !== 4) {
                    alert('Debe haber exactamente 4 días entre lunes y viernes');
                    return false;
                }

                return true;
            }

            initializeWeekData(weekKey) {
                if (!this.evaluationData[this.currentManager]) {
                    this.evaluationData[this.currentManager] = {};
                }

                if (!this.evaluationData[this.currentManager][weekKey]) {
                    this.evaluationData[this.currentManager][weekKey] = {};
                    
                    this.managers[this.currentManager].employees.forEach(employee => {
                        this.evaluationData[this.currentManager][weekKey][employee.id] = [];
                        
                        // Initialize 5 days (Monday to Friday)
                        for (let i = 0; i < 5; i++) {
                            this.evaluationData[this.currentManager][weekKey][employee.id][i] = {
                                ASISTENCIA: { checked: true, item: 'Sin problemas' },
                                PLÁTICAS: { checked: true, item: 'Sin problemas' },
                                PRODUCTIVIDAD: { checked: true, item: 'Sin problemas' },
                                ACTITUD: { checked: true, item: 'Sin problemas' }
                            };
                        }
                    });
                }

                this.saveData();
            }

            renderWeeklyEvaluationTable() {
    const tableBody = document.getElementById('evaluationTableBody');
    tableBody.innerHTML = '';

    if (!this.currentWeek || !this.evaluationData[this.currentManager] || !this.evaluationData[this.currentManager][this.currentWeek]) {
        return;
    }

    const weekData = this.evaluationData[this.currentManager][this.currentWeek];

    this.managers[this.currentManager].employees.forEach(employee => {
        const row = document.createElement('tr');
        row.innerHTML = `<td class="employee-name">${employee.name}</td>`;
        
        // Para cada día (5 días)
        for (let dayIndex = 0; dayIndex < 5; dayIndex++) {
            const dayData = weekData[employee.id][dayIndex];
            
            // Para cada categoría
            this.categories.forEach(category => {
                const isChecked = dayData[category].checked ? 'checked' : '';
                const selectClass = dayData[category].checked ? '' : 'has-issue';
                const categoryKey = this.categoryMapping[category];

                row.innerHTML += `
                    <td>
                        <div class="checkbox-container">
                            <input type="checkbox" class="evaluation-checkbox" 
                                   ${isChecked} 
                                   disabled>
                        </div>
                    </td>
                    <td>
                        <select class="item-select ${selectClass}" 
                                onchange="evaluationSystem.updateEvaluation('${employee.id}', ${dayIndex}, '${category}', 'item', this.value)">
                                ${this.evaluationItems[categoryKey].map(item => `
                                    <option value="${item}" ${item === dayData[category].item ? 'selected' : ''}>${item}</option>
                                `).join('')}
                        </select>
                    </td>
                `;
            });
        }
        
        tableBody.appendChild(row);
    });

    this.updateStats();
}

          
            updateEvaluation(employeeId, dayIndex, category, field, value) {
    if (!this.currentWeek || !this.evaluationData[this.currentManager] || !this.evaluationData[this.currentManager][this.currentWeek]) {
        return;
    }

    const weekData = this.evaluationData[this.currentManager][this.currentWeek];
    
    if (!weekData[employeeId] || !weekData[employeeId][dayIndex]) {
        return;
    }

    // Obtener la clave correcta para evaluationItems
    const categoryKey = this.categoryMapping[category];
    if (!categoryKey || !this.evaluationItems[categoryKey]) {
        console.error(`Categoría inválida: ${category}`);
        return;
    }

    // Actualizar los datos de evaluación
    if (field === 'item') {
        weekData[employeeId][dayIndex][category]['item'] = value;
        // Actualizar el estado del checkbox basado en el valor del select
        weekData[employeeId][dayIndex][category]['checked'] = (value === 'Sin problemas');
    } else if (field === 'checked') {
        // Si el checkbox es editado (caso hipotético), mantener el valor actual del select
        weekData[employeeId][dayIndex][category]['checked'] = value;
        // Asegurar que el checkbox refleje el valor del select
        if (weekData[employeeId][dayIndex][category]['item'] !== 'Sin problemas' && value) {
            weekData[employeeId][dayIndex][category]['checked'] = false; // Desmarcar si el item no es 'Sin problemas'
        } else if (weekData[employeeId][dayIndex][category]['item'] === 'Sin problemas' && !value) {
            weekData[employeeId][dayIndex][category]['checked'] = true; // Marcar si el item es 'Sin problemas'
        }
    }
   
    this.saveData();
    this.renderWeeklyEvaluationTable();
    
    // Actualizar tablas diarias si está en vista por día
    if (currentView === 'day') {
        this.renderDayTable(currentDay);
    }
}
            
            
            renderDayTable(day) {
    const dayIndex = this.days.indexOf(day);
    if (dayIndex === -1) return;

    const tableBodyId = {
        'LUNES': 'mondayTableBody',
        'MARTES': 'tuesdayTableBody',
        'MIÉRCOLES': 'wednesdayTableBody',
        'JUEVES': 'thursdayTableBody',
        'VIERNES': 'fridayTableBody'
    }[day];
    
    const tbody = document.getElementById(tableBodyId);
    tbody.innerHTML = '';
    
    if (!this.currentWeek || !this.evaluationData[this.currentManager] || !this.evaluationData[this.currentManager][this.currentWeek]) {
        return;
    }

    const weekData = this.evaluationData[this.currentManager][this.currentWeek];

    this.managers[this.currentManager].employees.forEach(employee => {
        const row = document.createElement('tr');
        row.innerHTML = `<td class="employee-name">${employee.name}</td>`;

        const dayData = weekData[employee.id][dayIndex];

        this.categories.forEach(category => {
            const isChecked = dayData[category].checked ? 'checked' : '';
            const selectClass = dayData[category].checked ? '' : 'has-issue';
            const categoryKey = this.categoryMapping[category];

            row.innerHTML += `
                <td>
                    <div class="checkbox-container">
                        <input type="checkbox" class="evaluation-checkbox" 
                               ${isChecked} 
                               disabled>
                    </div>
                </td>
                <td>
                    <select class="item-select ${selectClass}" 
                            onchange="evaluationSystem.updateEvaluation('${employee.id}', ${dayIndex}, '${category}', 'item', this.value)">
                            ${this.evaluationItems[categoryKey].map(item => `
                                <option value="${item}" ${item === dayData[category].item ? 'selected' : ''}>${item}</option>
                            `).join('')}
                    </select>
                </td>
            `;
        });

        tbody.appendChild(row);
    });
}
            updateStats() {
                if (!this.currentWeek || !this.evaluationData[this.currentManager] || !this.evaluationData[this.currentManager][this.currentWeek]) {
                    return;
                }

                const statsGrid = document.getElementById('statsGrid');
                statsGrid.innerHTML = '';

                const weekData = this.evaluationData[this.currentManager][this.currentWeek];
                const employees = this.managers[this.currentManager].employees;

                // Stats for each day
                for (let dayIndex = 0; dayIndex < 5; dayIndex++) {
                    const dayName = this.days[dayIndex];
                    
                    let totalEmployees = employees.length;
                    let perfectEmployees = 0;
                    let categoryStats = {
                        ASISTENCIA: 0,
                        PLÁTICAS: 0,
                        PRODUCTIVIDAD: 0,
                        ACTITUD: 0
                    };

                    employees.forEach(employee => {
                        const employeeData = weekData[employee.id][dayIndex];
                        if (employeeData) {
                            let isPerfect = true;
                            Object.keys(categoryStats).forEach(category => {
                                if (employeeData[category] && employeeData[category].checked) {
                                    categoryStats[category]++;
                                } else {
                                    isPerfect = false;
                                }
                            });
                            if (isPerfect) perfectEmployees++;
                        }
                    });

                    statsGrid.innerHTML += `
                        <div class="stat-item">
                            <div class="stat-number">${perfectEmployees}/${totalEmployees}</div>
                            <div>Perfectos ${dayName}</div>
                        </div>
                    `;
                }
            }

            loadWeek() {
                const weekKey = document.getElementById('weekSelect').value;
                if (!weekKey) {
                    alert('Por favor selecciona una semana');
                    return;
                }

                this.currentWeek = weekKey;
                this.renderWeeklyEvaluationTable();
                document.getElementById('evaluationSection').classList.remove('hidden');
                document.getElementById('weekHeader').textContent = weekKey;
            }

            saveData() {
                localStorage.setItem('employeeEvaluationData', JSON.stringify(this.evaluationData));
            }

            loadStoredData() {
                const stored = localStorage.getItem('employeeEvaluationData');
                if (stored) {
                    this.evaluationData = JSON.parse(stored);
                }
            }
        }

        // Global variables
        let evaluationSystem;
        let currentView = 'week';
        let currentDay = 'LUNES';

        // Global functions
        function login() {
            evaluationSystem.login();
        }

        function createNewWeek() {
            evaluationSystem.createNewWeek();
        }

        function loadWeek() {
            evaluationSystem.loadWeek();
        }

        function showWeekView() {
            currentView = 'week';
            document.getElementById('weeklyTable').style.display = 'table';
            document.getElementById('dayNavigation').style.display = 'none';
            document.getElementById('reportsModule').style.display = 'none';
            
            // Hide all day tables
            const dayTables = document.querySelectorAll('.single-day-table');
            dayTables.forEach(table => table.style.display = 'none');
        }

        function showDayView() {
            if (!evaluationSystem.currentWeek) {
                alert('Por favor selecciona o crea una semana primero');
                return;
            }
            
            currentView = 'day';
            document.getElementById('weeklyTable').style.display = 'none';
            document.getElementById('dayNavigation').style.display = 'block';
            document.getElementById('reportsModule').style.display = 'none';
            selectDay(currentDay);
        }

        function showReports() {
            currentView = 'reports';
            document.getElementById('weeklyTable').style.display = 'none';
            document.getElementById('dayNavigation').style.display = 'none';
            document.getElementById('reportsModule').style.display = 'block';
            
            // Hide all day tables
            const dayTables = document.querySelectorAll('.single-day-table');
            dayTables.forEach(table => table.style.display = 'none');
        }

        function selectDay(day) {
            currentDay = day;
            
            // Update active tab
            document.querySelectorAll('.day-tab').forEach(tab => tab.classList.remove('active'));
            
            // Find and activate the clicked tab
            const dayTabs = document.querySelectorAll('.day-tab');
            dayTabs.forEach(tab => {
                if (tab.textContent === day) {
                    tab.classList.add('active');
                }
            });
            
            // Hide all day tables
            const dayTables = document.querySelectorAll('.single-day-table');
            dayTables.forEach(table => table.style.display = 'none');
            
            // Show selected day table
            const dayMap = {
                'LUNES': 'mondayTable',
                'MARTES': 'tuesdayTable',
                'MIÉRCOLES': 'wednesdayTable',
                'JUEVES': 'thursdayTable',
                'VIERNES': 'fridayTable'
            };
            
            document.getElementById(dayMap[day]).style.display = 'table';
            
            // Render the day table
            evaluationSystem.renderDayTable(day);
        }

        function generatePDFReport() {
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            
            if (!startDate || !endDate) {
                alert('Por favor ingrese ambas fechas');
                return;
            }
            
            // Create PDF content
            let pdfContent = `
                <html>
                <head>
                    <title>Reporte de Evaluaciones</title>
                    <style>
                        body { font-family: Arial, sans-serif; }
                        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #4CAF50; color: white; }
                        .header { text-align: center; margin: 20px 0; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>Reporte de Evaluaciones</h1>
                        <p>Período: ${startDate} - ${endDate}</p>
                        <p>Manager: ${evaluationSystem.managers[evaluationSystem.currentManager].name}</p>
                    </div>
            `;
            
            const managerData = evaluationSystem.evaluationData[evaluationSystem.currentManager] || {};
            
            Object.keys(managerData).forEach(weekKey => {
                const weekData = managerData[weekKey];
                pdfContent += `<h2>Semana: ${weekKey}</h2>`;
                pdfContent += generateReportTable(weekData);
            });
            
            pdfContent += '</body></html>';
            
            // Open in new window for printing
            const printWindow = window.open('', '_blank');
            printWindow.document.write(pdfContent);
            printWindow.document.close();
            printWindow.print();
        }

        function generateCSVReport() {
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            
            if (!startDate || !endDate) {
                alert('Por favor ingrese ambas fechas');
                return;
            }
            
            let csvContent = 'Empleado,Semana,Día,Categoría,Estado,Item\n';
            
            const managerData = evaluationSystem.evaluationData[evaluationSystem.currentManager] || {};
            
            Object.keys(managerData).forEach(weekKey => {
                const weekData = managerData[weekKey];
                
                Object.keys(weekData).forEach(employeeId => {
                    const employee = evaluationSystem.managers[evaluationSystem.currentManager].employees.find(emp => emp.id === employeeId);
                    if (!employee) return;
                    
                    weekData[employeeId].forEach((dayData, dayIndex) => {
                        const dayName = evaluationSystem.days[dayIndex];
                        
                        evaluationSystem.categories.forEach(category => {
                            if (dayData[category]) {
                                csvContent += `"${employee.name}","${weekKey}","${dayName}","${category}","${dayData[category].checked ? 'Aprobado' : 'No Aprobado'}","${dayData[category].item}"\n`;
                            }
                        });
                    });
                });
            });
            
            // Download CSV
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `reporte_evaluaciones_${startDate}_${endDate}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function generateReportTable(weekData) {
            let tableHTML = '<table><thead><tr><th>Empleado</th><th>Día</th><th>Categoría</th><th>Estado</th><th>Item</th></tr></thead><tbody>';
            
            Object.keys(weekData).forEach(employeeId => {
                const employee = evaluationSystem.managers[evaluationSystem.currentManager].employees.find(emp => emp.id === employeeId);
                if (!employee) return;
                
                weekData[employeeId].forEach((dayData, dayIndex) => {
                    const dayName = evaluationSystem.days[dayIndex];
                    
                    evaluationSystem.categories.forEach(category => {
                        if (dayData[category]) {
                            tableHTML += `<tr>
                                <td>${employee.name}</td>
                                <td>${dayName}</td>
                                <td>${category}</td>
                                <td>${dayData[category].checked ? 'Aprobado' : 'No Aprobado'}</td>
                                <td>${dayData[category].item}</td>
                            </tr>`;
                        }
                    });
                });
            });
            
            tableHTML += '</tbody></table>';
            return tableHTML;
        }

        // Initialize system when page loads
        document.addEventListener('DOMContentLoaded', function() {
            evaluationSystem = new EmployeeEvaluationSystem();
            alert("Sistema inicializado");
        });
    </script>
</body>
</html>